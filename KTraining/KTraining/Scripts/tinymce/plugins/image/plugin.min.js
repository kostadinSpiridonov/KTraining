tinymce.PluginManager.add("image",function(n){function r(n,t){function u(n,r){i.parentNode&&i.parentNode.removeChild(i),t({width:n,height:r})}var i=document.createElement("img"),r;i.onload=function(){u(i.clientWidth,i.clientHeight)},i.onerror=function(){u()},r=i.style,r.visibility="hidden",r.position="fixed",r.bottom=r.left=0,r.width=r.height="auto",document.body.appendChild(i),i.src=n}function t(t){return function(){var i=n.settings.image_list;typeof i=="string"?tinymce.util.XHR.send({url:i,success:function(n){t(tinymce.util.JSON.parse(n))}}):t(i)}}function i(t){function w(t,r,u){var f,e=[];return tinymce.each(n.settings[t]||u,function(n){var t={text:n.text||n.title,value:n.value};e.push(t),(i[r]===n.value||!f&&n.selected)&&(f=t)}),f&&!i[r]&&(i[r]=f.value,f.selected=!0),e}function b(){var i=[{text:"None",value:""}];return tinymce.each(t,function(t){i.push({text:t.text||t.title,value:n.convertURL(t.value||t.url,"src"),menu:t.menu})}),i}function c(){var i,r,n,t;i=e.find("#width")[0],r=e.find("#height")[0],n=i.value(),t=r.value(),e.find("#constrain")[0].checked()&&o&&s&&n&&t&&(o!=n?(t=Math.round(n/o*t),r.value(t)):(n=Math.round(t/s*n),i.value(n))),o=n,s=t}function y(){function t(t){function r(){t.onload=t.onerror=null,n.selection.select(t),n.nodeChanged()}t.onload=function(){i.width||i.height||f.setAttribs(t,{width:t.clientWidth,height:t.clientHeight}),r()},t.onerror=r}p(),c(),i=tinymce.extend(i,e.toJSON()),i.width===""&&(i.width=null),i.height===""&&(i.height=null),i.style===""&&(i.style=null),i={src:i.src,alt:i.alt,width:i.width,height:i.height,style:i.style,"class":i["class"]},i["class"]||delete i["class"],n.undoManager.transact(function(){if(!i.src){u&&(f.remove(u),n.focus(),n.nodeChanged());return}u?f.setAttribs(u,i):(i.id="__mcenew",n.focus(),n.selection.setContent(f.createHTML("img",i)),u=f.get("__mcenew"),f.setAttrib(u,"id",null)),t(u)})}function l(n){return n&&(n=n.replace(/px$/,"")),n}function k(){h&&h.value(n.convertURL(this.value(),"src")),r(this.value(),function(n){n.width&&n.height&&(o=n.width,s=n.height,e.find("#width").value(o),e.find("#height").value(s))})}function p(){function r(n){return n.length>0&&/^[0-9]+$/.test(n)&&(n+="px"),n}if(n.settings.image_advtab){var i=e.toJSON(),t=f.parseStyle(i.style);delete t.margin,t["margin-top"]=t["margin-bottom"]=r(i.vspace),t["margin-left"]=t["margin-right"]=r(i.hspace),t["border-width"]=r(i.border),e.find("#style").value(f.serializeStyle(f.parseStyle(f.serializeStyle(t))))}}var e,i={},f=n.dom,u=n.selection.getNode(),o,s,h,v,a;o=f.getAttrib(u,"width"),s=f.getAttrib(u,"height"),u.nodeName!="IMG"||u.getAttribute("data-mce-object")||u.getAttribute("data-mce-placeholder")?u=null:i={src:f.getAttrib(u,"src"),alt:f.getAttrib(u,"alt"),"class":f.getAttrib(u,"class"),width:o,height:s},t&&(h={type:"listbox",label:"Image list",values:b(),value:i.src&&n.convertURL(i.src,"src"),onselect:function(n){var t=e.find("#alt");(!t.value()||n.lastControl&&t.value()==n.lastControl.text())&&t.value(n.control.text()),e.find("#src").value(n.control.value())},onPostRender:function(){h=this}}),n.settings.image_class_list&&(v={name:"class",type:"listbox",label:"Class",values:w("image_class_list","class")}),a=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:k},h,{name:"alt",type:"textbox",label:"Image description"},{type:"container",label:"Dimensions",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:3,onchange:c,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:3,onchange:c,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]},v],n.settings.image_advtab?(u&&(i.hspace=l(u.style.marginLeft||u.style.marginRight),i.vspace=l(u.style.marginTop||u.style.marginBottom),i.border=l(u.style.borderWidth),i.style=n.dom.serializeStyle(n.dom.parseStyle(n.dom.getAttrib(u,"style")))),e=n.windowManager.open({title:"Insert/edit image",data:i,bodyType:"tabpanel",body:[{title:"General",type:"form",items:a},{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox"},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:p},items:[{label:"Vertical space",name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}]}],onSubmit:y})):e=n.windowManager.open({title:"Insert/edit image",data:i,body:a,onSubmit:y})}n.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:t(i),stateSelector:"img:not([data-mce-object],[data-mce-placeholder])"}),n.addMenuItem("image",{icon:"image",text:"Insert image",onclick:t(i),context:"insert",prependToContext:!0})});
//@ sourceMappingURL=plugin.min.js.map